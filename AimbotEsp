local uis = game.UserInputService

local player = game.Players.LocalPlayer
local mouse = player:GetMouse()
local camera = workspace.CurrentCamera

--local aimGui = script.Parent
--local aimCircle = aimGui.AimCircle

-- ตั้งค่าความเร็วและขนาดของวงกลมช่วยเล็ง
local aimSpeed = 1  -- ค่าต่ำ = เล็งช้า, ค่าสูง = เล็งไว
local aimRadius = 200 -- ขนาดของวงกลมช่วยเล็ง

local aiming = false

-- ปรับขนาดของวงกลมให้ตรงกับ aimRadius
--aimCircle.Size = UDim2.new(0, aimRadius * 2, 0, aimRadius * 2)

local function getClosestTarget()
	local closestEnemy = nil
	local shortestDistance = aimRadius * 1.1

	for _, character in pairs(workspace:GetChildren()) do
		if character:IsA("Model") and character:FindFirstChild("Humanoid") and character ~= player.Character then
			local head = character:FindFirstChild("Head")
			if head then
				local screenPos, onScreen = camera:WorldToViewportPoint(head.Position)
				local distance = (Vector2.new(screenPos.X, screenPos.Y) - Vector2.new(mouse.X, mouse.Y)).magnitude

				if onScreen and distance < shortestDistance then
					shortestDistance = distance
					closestEnemy = head
				end
			end
		end
	end

	return closestEnemy
end

-- เมื่อคลิกเมาส์เริ่มล็อกเป้า
mouse.Button1Down:Connect(function()
	--aiming = true
end)

-- เมื่อปล่อยเมาส์หยุดล็อกเป้า
mouse.Button1Up:Connect(function()
	--aiming = false
end)

uis.InputBegan:Connect(function(i,p)
	if p then return end
	
	if i.KeyCode == Enum.KeyCode.Q then
		aiming = not aiming
	end
end)

game:GetService("RunService").RenderStepped:Connect(function()
	-- อัปเดตตำแหน่งของวงกลมให้ตามเมาส์
	--aimCircle.Position = UDim2.new(0, mouse.X, 0, mouse.Y)

	if aiming then
		local target = getClosestTarget()
		if target then
			local targetPos = target.Position
			local currentPos = camera.CFrame.Position
			local newCFrame = CFrame.new(currentPos, targetPos)

			-- ปรับการหมุนของกล้องไปยังเป้าหมายอย่าง Smooth
			--camera.CFrame = camera.CFrame:Lerp(newCFrame, aimSpeed)
			camera.CFrame = newCFrame
		end
	end
end)
